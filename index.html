<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìÖ Calendar Planner NPR:üë©‚Äçüíª </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        body { box-sizing: border-box; height: 100%; margin: 0; font-family: 'Sarabun', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        html { height: 100%; }
        
        /* --- (‡πÉ‡∏´‡∏°‡πà) Main Layout (‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô + ‡πÇ‡∏ô‡πâ‡∏ï) --- */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr; /* Mobile: 1 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
            gap: 24px;
        }
        @media (min-width: 1024px) { /* Desktop: 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
            .main-layout {
                grid-template-columns: 3fr 1fr; 
            }
            .calendar-container { max-width: 100%; }
            .notes-container {
                display: flex;
                flex-direction: column;
                max-height: 90vh; 
                position: sticky;
                top: 2rem;
            }
            #notes-list-wrapper {
                flex-grow: 1; 
                overflow-y: auto; 
                padding-right: 8px;
                scrollbar-width: thin;
                scrollbar-color: #cbd5e1 #f1f5f9;
            }
            #notes-list-wrapper::-webkit-scrollbar { width: 5px; }
            #notes-list-wrapper::-webkit-scrollbar-track { background: #f1f5f9; }
            #notes-list-wrapper::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 6px; }
        }
        /* ------------------------------------- */

        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #e5e7eb; }
        
        .calendar-day { 
            background-color: white; 
            height: 150px; 
            padding: 8px; 
            position: relative; 
            cursor: pointer;
            font-size: 1rem;
            display: flex; 
            flex-direction: column; 
        } 
        .calendar-day.other-month { background-color: #f9fafb; color: #9ca3af; cursor: default; } 
        
        .day-content-wrapper {
            flex-grow: 1; 
            overflow-y: auto; 
            overflow-x: hidden;
            margin-top: 4px;
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 #f1f5f9;
        }
        .day-content-wrapper::-webkit-scrollbar { width: 5px; }
        .day-content-wrapper::-webkit-scrollbar-track { background: #f1f5f9; }
        .day-content-wrapper::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 6px; }

        .calendar-day.today {
            background-color: #a7f3d0 !important; 
        }
        
        .calendar-day.company-holiday { background-color: #fee2e2 !important; border-left: 4px solid #dc2626; }
        .calendar-day.public-holiday { background-color: #ffedd5; border-left: 4px solid #f97316; }
        
        .holiday-label {
            font-size: 0.9rem; 
            font-weight: 500;
            margin-bottom: 2px;
            white-space: normal; 
            word-break: break-word; 
            line-height: 1.2;
        }

        .event-item { 
            background-color: #3b82f6; 
            color: white; 
            padding: 2px 6px; 
            margin: 2px 0; 
            border-radius: 4px; 
            font-size: 0.875rem; 
            cursor: pointer; 
            overflow: hidden; 
            white-space: normal; 
            word-break: break-word; 
        }
        
        .event-item.company-event {
            background-color: #ef4444; 
        }
        .event-item.company-event:hover {
            background-color: #dc2626; 
        }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; }
        .modal.show { display: flex; align-items: center; justify-content: center; }
        .spinner { border: 4px solid rgba(0, 0, 0, 0.1); width: 36px; height: 36px; border-radius: 50%; border-left-color: #3b82f6; animation: spin 1s ease infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .day-number { pointer-events: none; font-size: 1.25rem; flex-shrink: 0; }
        .day-name-full { display: block; }
        .day-name-short { display: none; }
        .desktop-text { display: inline; }

        @media (max-width: 1023px) { 
            .container { padding: 4px; }
            .calendar-day { height: 100px; padding: 2px; }
            .day-number { font-size: 0.8rem; }
            .holiday-label { font-size: 0.6rem; white-space: normal; word-break: break-word; }
            .event-item { font-size: 0.7rem; padding: 1px 2px; margin: 1px 0; white-space: normal; word-break: break-word; } 
            .desktop-text { display: none; }
            #calendar-title { font-size: 1.5rem; margin-bottom: 0.5rem; }
            .header-controls { flex-direction: column; gap: 8px; }
            .month-navigation { order: 1; }
            #add-event-btn { order: 2; padding: 6px 10px; font-size: 0.8rem; }
            #prev-month, #next-month { padding: 6px 8px; font-size: 0.8rem; }
            #current-month { font-size: 1.1rem; padding: 0 8px; }
            .legend-container { justify-content: center; }
            .day-name-full { display: none !important; }
            .day-name-short { display: block !important; }
            .notes-container { margin-top: 24px; }
        }

        @media (min-width: 1024px) {
            .container.mx-auto {
                max-width: 100%;
                padding-left: 2rem;
                padding-right: 2rem;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <div class="container mx-auto p-6 max-w-6xl">
        
        <div class="main-layout">
            
            <div class="calendar-container">
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h1 id="calendar-title" class="text-3xl font-bold text-gray-800 mb-4">Calendar Planner NPR:ADüë©‚Äçüíª</h1>
                    <div class="flex flex-wrap gap-4 items-center header-controls">
                        <button id="add-event-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors"> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà </button>
                        <div class="flex items-center gap-2 month-navigation">
                            <button id="prev-month" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg transition-colors"> ‚Üê ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô </button>
                            <span id="current-month" class="text-xl font-semibold text-gray-700 px-4 w-48 text-center"></span> <button id="next-month" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg transition-colors"> ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí </button>
                        </div>
                    </div>
                    <div class="mt-4 flex flex-wrap gap-4 text-sm legend-container">
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-red-100 border-l-4 border-red-600 rounded"></div>
                            <span class="text-gray-600">üî¥ ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ø</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-orange-100 border-l-4 border-orange-600 rounded"></div>
                            <span class="text-gray-600">üèõÔ∏è ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4" style="background-color: #a7f3d0;"></div>
                            <span class="text-gray-600">üìÖ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏°‡∏≤‡∏ñ‡∏∂‡∏á (7 ‡∏ß‡∏±‡∏ô)</h2>
                    <div id="upcoming-events" class="space-y-3">
                        <div class="spinner"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="calendar-grid bg-gray-100 text-center font-semibold text-gray-700">
                        <div class="p-4 day-name-full">‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</div>
                        <div class="p-4 day-name-full">‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</div>
                        <div class="p-4 day-name-full">‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£</div>
                        <div class="p-4 day-name-full">‡∏û‡∏∏‡∏ò</div>
                        <div class="p-4 day-name-full">‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ</div>
                        <div class="p-4 day-name-full">‡∏®‡∏∏‡∏Å‡∏£‡πå</div>
                        <div class="p-4 day-name-full">‡πÄ‡∏™‡∏≤‡∏£‡πå</div>
                        <div class="p-2 day-name-short">‡∏≠‡∏≤</div>
                        <div class="p-2 day-name-short">‡∏à</div>
                        <div class="p-2 day-name-short">‡∏≠</div>
                        <div class="p-2 day-name-short">‡∏û</div>
                        <div class="p-2 day-name-short">‡∏û‡∏§</div>
                        <div class="p-2 day-name-short">‡∏®</div>
                        <div class="p-2 day-name-short">‡∏™</div>
                    </div>
                    <div id="calendar-days" class="calendar-grid">
                        <div class="col-span-7 p-10 text-center text-gray-500">
                            <div class="spinner"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6 mt-6">
                    <h2 id="monthly-summary-title" class="text-xl font-bold text-gray-800 mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô [‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏õ‡∏µ] </h2>
                    <div id="monthly-summary-events" class="space-y-3">
                        <p class="text-gray-500 text-center py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
                    </div>
                </div>
            </div>
            <div class="notes-container bg-white rounded-lg shadow-md p-6">
                <h2 id="notes-title" class="text-xl font-bold text-gray-800 mb-4">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)</h2>
                
                <div class="mb-4">
                    <textarea id="new-note-textarea" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÇ‡∏ô‡πâ‡∏ï‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
                    <button id="save-note-btn" class="mt-2 w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏ô‡πâ‡∏ï
                    </button>
                </div>
                
                <div id="notes-list-wrapper" class="space-y-3">
                    <div class="spinner"></div>
                </div>
            </div>
            </div>
        </div>

    <div id="add-event-modal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h2 class="text-xl font-bold text-gray-800 mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà</h2>
            <form id="add-event-form">
                <div class="mb-4"><label for="event-title" class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label> <input type="text" id="event-title" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></div>
                <div class="mb-4"><label for="event-date" class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label> <input type="date" id="event-date" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></div>
                <div class="mb-4"><label for="event-time" class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label> <input type="time" id="event-time" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></div>
                <div class="mb-4"><label for="event-description" class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label> <textarea id="event-description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea></div>
                <div class="mb-6"><label for="event-author" class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°</label> <input type="text" id="event-author" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></div>
                <div class="flex gap-3">
                    <button type="submit" id="save-event-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition-colors"> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å </button>
                    <button type="button" id="cancel-event-btn" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg font-medium transition-colors"> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button>
                </div>
            </form>
        </div>
    </div>

    <div id="event-details-modal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h2 class="text-xl font-bold text-gray-800 mb-4">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>
            <div id="event-details-content"></div>
            <div class="flex gap-3 mt-6">
                <button id="delete-event-btn" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-medium transition-colors"> ‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° </button>
                <button id="close-details-btn" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg font-medium transition-colors"> ‡∏õ‡∏¥‡∏î </button>
            </div>
        </div>
    </div>

    <script>
        // --- Firebase Configuration for work-calendar-fe6c1 ---
        const firebaseConfig = {
          apiKey: "AIzaSyA6yXwcdOihGZcttFwdB6ax_Wb_S8NHMGQ",
          authDomain: "work-calendar-fe6c1.firebaseapp.com",
          databaseURL: "https://work-calendar-fe6c1-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "work-calendar-fe6c1",
          storageBucket: "work-calendar-fe6c1.firebasestorage.app",
          messagingSenderId: "792437599231",
          appId: "1:792437599231:web:2420688ca88867f57155ca",
          measurementId: "G-XK0NJMT3EG" 
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const eventsRef = db.ref("calendar_events"); 
        
        // --- (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) Firebase Reference ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏ô‡πâ‡∏ï (‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô) ---
        const monthlyNotesRef = db.ref("monthly_notes"); 
        let currentNotesListenerRef = null; // (‡πÉ‡∏´‡∏°‡πà) ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö listener ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        // ---------------------------------------------

        let currentDate = new Date();
        let allEvents = {}; 
        let selectedEventKey = null; 

        const thaiMonths = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];

        // --- (FIXED) Holiday Data (2568 - 2575) - FULL VERSION ---
        const thaiHolidays = {
            // 2568 (2025)
            '2025-01-01': '‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà', '2025-02-12': '‡∏°‡∏≤‡∏Ü‡∏ö‡∏π‡∏ä‡∏≤', '2025-04-06': '‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏Å‡∏£‡∏µ', '2025-04-07': '‡∏ä‡∏î‡πÄ‡∏ä‡∏¢‡∏à‡∏±‡∏Å‡∏£‡∏µ',
            '2025-04-13': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2025-04-14': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2025-04-15': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2025-05-01': '‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô',
            '2025-05-04': '‡∏â‡∏±‡∏ï‡∏£‡∏°‡∏á‡∏Ñ‡∏•', '2025-05-05': '‡∏ä‡∏î‡πÄ‡∏ä‡∏¢‡∏â‡∏±‡∏ï‡∏£‡∏°‡∏á‡∏Ñ‡∏•', '2025-05-12': '‡∏ß‡∏¥‡∏™‡∏≤‡∏Ç‡∏ö‡∏π‡∏ä‡∏≤ (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', 
            '2025-06-03': '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤ ‡∏™‡∏∏‡∏ó‡∏¥‡∏î‡∏≤', '2025-07-28': '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤ ‡∏£.10',
            '2025-08-11': '‡∏≠‡∏≤‡∏™‡∏≤‡∏¨‡∏´‡∏ö‡∏π‡∏ä‡∏≤ (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2025-08-12': '‡∏ß‡∏±‡∏ô‡πÅ‡∏°‡πà/‡∏û‡∏±‡∏ô‡∏õ‡∏µ‡∏´‡∏•‡∏ß‡∏á', 
            '2025-10-13': '‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡∏ï ‡∏£.9', '2025-10-23': '‡∏õ‡∏¥‡∏¢‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä',
            '2025-12-05': '‡∏ß‡∏±‡∏ô‡∏û‡πà‡∏≠/‡∏£.9', '2025-12-10': '‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç', '2025-12-31': '‡∏™‡∏¥‡πâ‡∏ô‡∏õ‡∏µ',

            // 2569 (2026)
            '2026-01-01': '‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà', '2026-03-04': '‡∏°‡∏≤‡∏Ü‡∏ö‡∏π‡∏ä‡∏≤', '2026-04-06': '‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏Å‡∏£‡∏µ',
            '2026-04-13': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2026-04-14': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2026-04-15': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2026-05-01': '‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô',
            '2026-05-04': '‡∏â‡∏±‡∏ï‡∏£‡∏°‡∏á‡∏Ñ‡∏•', '2026-05-30': '‡∏ß‡∏¥‡∏™‡∏≤‡∏Ç‡∏ö‡∏π‡∏ä‡∏≤', '2026-06-03': '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤ ‡∏™‡∏∏‡∏ó‡∏¥‡∏î‡∏≤', 
            '2026-07-27': '‡∏≠‡∏≤‡∏™‡∏≤‡∏¨‡∏´‡∏ö‡∏π‡∏ä‡∏≤ (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2026-07-28': '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤ ‡∏£.10',
            '2026-08-12': '‡∏ß‡∏±‡∏ô‡πÅ‡∏°‡πà/‡∏û‡∏±‡∏ô‡∏õ‡∏µ‡∏´‡∏•‡∏ß‡∏á', '2026-10-13': '‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡∏ï ‡∏£.9', '2026-10-23': '‡∏õ‡∏¥‡∏¢‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä', 
            '2026-12-05': '‡∏ß‡∏±‡∏ô‡∏û‡πà‡∏≠/‡∏£.9', '2026-12-07': '‡∏ä‡∏î‡πÄ‡∏ä‡∏¢ ‡∏£.9', '2026-12-10': '‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç', '2026-12-31': '‡∏™‡∏¥‡πâ‡∏ô‡∏õ‡∏µ',

            // 2570 (2027)
            '2027-01-01': '‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà', '2027-02-22': '‡∏°‡∏≤‡∏Ü‡∏ö‡∏π‡∏ä‡∏≤', '2027-04-06': '‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏Å‡∏£‡∏µ',
            '2027-04-13': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2027-04-14': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2027-04-15': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2027-05-03': '‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)',
            '2027-05-04': '‡∏â‡∏±‡∏ï‡∏£‡∏°‡∏á‡∏Ñ‡∏•', '2027-05-15': '‡∏ß‡∏¥‡∏™‡∏≤‡∏Ç‡∏ö‡∏π‡∏ä‡∏≤', '2027-06-03': '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤ ‡∏™‡∏∏‡∏ó‡∏¥‡∏î‡∏≤', 
            '2027-07-26': '‡∏≠‡∏≤‡∏™‡∏≤‡∏¨‡∏´‡∏ö‡∏π‡∏ä‡∏≤ (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2027-07-28': '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤ ‡∏£.10',
            '2027-08-12': '‡∏ß‡∏±‡∏ô‡πÅ‡∏°‡πà/‡∏û‡∏±‡∏ô‡∏õ‡∏µ‡∏´‡∏•‡∏ß‡∏á', '2027-10-13': '‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡∏ï ‡∏£.9', '2027-10-25': '‡∏õ‡∏¥‡∏¢‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', 
            '2027-12-06': '‡∏ß‡∏±‡∏ô‡∏û‡πà‡∏≠/‡∏£.9 (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2027-12-10': '‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç', '2027-12-31': '‡∏™‡∏¥‡πâ‡∏ô‡∏õ‡∏µ',
            
            // 2571 (2028)
            '2028-01-03': '‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2028-02-11': '‡∏°‡∏≤‡∏Ü‡∏ö‡∏π‡∏ä‡∏≤', '2028-04-06': '‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏Å‡∏£‡∏µ',
            '2028-04-13': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2028-04-14': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2028-04-17': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2028-05-01': '‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô',
            '2028-05-04': '‡∏â‡∏±‡∏ï‡∏£‡∏°‡∏á‡∏Ñ‡∏•', '2028-05-08': '‡∏ß‡∏¥‡∏™‡∏≤‡∏Ç‡∏ö‡∏π‡∏ä‡∏≤ (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2028-06-05': '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤‡∏Ø (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', 
            '2028-07-28': '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤ ‡∏£.10', '2028-08-11': '‡∏ß‡∏±‡∏ô‡πÅ‡∏°‡πà/‡∏û‡∏±‡∏ô‡∏õ‡∏µ‡∏´‡∏•‡∏ß‡∏á (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', 
            '2028-10-13': '‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡∏ï ‡∏£.9', '2028-10-23': '‡∏õ‡∏¥‡∏¢‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä',
            '2028-12-05': '‡∏ß‡∏±‡∏ô‡∏û‡πà‡∏≠/‡∏£.9', '2028-12-11': '‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)',
            
            // 2572 (2029)
            '2029-01-01': '‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà', '2029-01-02': '‡∏ä‡∏î‡πÄ‡∏ä‡∏¢‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà', '2029-02-28': '‡∏°‡∏≤‡∏Ü‡∏ö‡∏π‡∏ä‡∏≤', '2029-04-06': '‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏Å‡∏£‡∏µ',
            '2029-04-13': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2029-04-16': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2029-04-17': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2029-05-01': '‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô',
            '2029-05-07': '‡∏â‡∏±‡∏ï‡∏£‡∏°‡∏á‡∏Ñ‡∏• (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2029-05-28': '‡∏ß‡∏¥‡∏™‡∏≤‡∏Ç‡∏ö‡∏π‡∏ä‡∏≤ (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2029-06-04': '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤‡∏Ø (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', 
            '2029-07-28': '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤ ‡∏£.10', '2029-08-13': '‡∏ß‡∏±‡∏ô‡πÅ‡∏°‡πà/‡∏û‡∏±‡∏ô‡∏õ‡∏µ‡∏´‡∏•‡∏ß‡∏á (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', 
            '2029-10-15': '‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡∏ï ‡∏£.9 (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2029-10-23': '‡∏õ‡∏¥‡∏¢‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä',
            '2029-12-05': '‡∏ß‡∏±‡∏ô‡∏û‡πà‡∏≠/‡∏£.9', '2029-12-10': '‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç', '2029-12-31': '‡∏™‡∏¥‡πâ‡∏ô‡∏õ‡∏µ',
            
            // 2573 (2030)
            '2030-01-01': '‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà', '2030-02-18': '‡∏°‡∏≤‡∏Ü‡∏ö‡∏π‡∏ä‡∏≤', '2030-04-08': '‡∏à‡∏±‡∏Å‡∏£‡∏µ (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)',
            '2030-04-14': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2030-04-15': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2030-04-16': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2030-05-01': '‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô',
            '2030-05-06': '‡∏â‡∏±‡∏ï‡∏£‡∏°‡∏á‡∏Ñ‡∏• (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2030-05-18': '‡∏ß‡∏¥‡∏™‡∏≤‡∏Ç‡∏ö‡∏π‡∏ä‡∏≤', '2030-06-03': '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤ ‡∏™‡∏∏‡∏ó‡∏¥‡∏î‡∏≤', 
            '2030-07-28': '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤ ‡∏£.10', '2030-07-29': '‡∏ä‡∏î‡πÄ‡∏ä‡∏¢ ‡∏£.10', 
            '2030-08-12': '‡∏ß‡∏±‡∏ô‡πÅ‡∏°‡πà/‡∏û‡∏±‡∏ô‡∏õ‡∏µ‡∏´‡∏•‡∏ß‡∏á', '2030-10-14': '‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡∏ï ‡∏£.9 (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2030-10-23': '‡∏õ‡∏¥‡∏¢‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä',
            '2030-12-05': '‡∏ß‡∏±‡∏ô‡∏û‡πà‡∏≠/‡∏£.9', '2030-12-10': '‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç', '2030-12-31': '‡∏™‡∏¥‡πâ‡∏ô‡∏õ‡∏µ',

            // 2574 (2031)
            '2031-01-01': '‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà', '2031-02-07': '‡∏°‡∏≤‡∏Ü‡∏ö‡∏π‡∏ä‡∏≤', '2031-04-07': '‡∏à‡∏±‡∏Å‡∏£‡∏µ (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)',
            '2031-04-14': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2031-04-15': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2031-04-16': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2031-05-01': '‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô',
            '2031-05-05': '‡∏â‡∏±‡∏ï‡∏£‡∏°‡∏á‡∏Ñ‡∏• (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2031-06-02': '‡∏ß‡∏¥‡∏™‡∏≤‡∏Ç‡∏ö‡∏π‡∏ä‡∏≤ (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2031-06-03': '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤ ‡∏™‡∏∏‡∏ó‡∏¥‡∏î‡∏≤', 
            '2031-07-28': '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤ ‡∏£.10', '2031-08-12': '‡∏ß‡∏±‡∏ô‡πÅ‡∏°‡πà/‡∏û‡∏±‡∏ô‡∏õ‡∏µ‡∏´‡∏•‡∏ß‡∏á', 
            '2031-10-13': '‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡∏ï ‡∏£.9', '2031-10-23': '‡∏õ‡∏¥‡∏¢‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä',
            '2031-12-08': '‡∏ß‡∏±‡∏ô‡∏û‡πà‡∏≠/‡∏£.9 (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2031-12-10': '‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç', '2031-12-31': '‡∏™‡∏¥‡πâ‡∏ô‡∏õ‡∏µ',
            
            // 2575 (2032)
            '2032-01-01': '‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà', '2032-02-26': '‡∏°‡∏≤‡∏Ü‡∏ö‡∏π‡∏ä‡∏≤', '2032-04-05': '‡∏à‡∏±‡∏Å‡∏£‡∏µ (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)',
            '2032-04-13': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2032-04-14': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2032-04-15': '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2032-05-03': '‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)',
            '2032-05-04': '‡∏â‡∏±‡∏ï‡∏£‡∏°‡∏á‡∏Ñ‡∏•', '2032-05-17': '‡∏ß‡∏¥‡∏™‡∏≤‡∏Ç‡∏ö‡∏π‡∏ä‡∏≤ (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2032-06-03': '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤ ‡∏™‡∏∏‡∏ó‡∏¥‡∏î‡∏≤', 
            '2032-07-28': '‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤ ‡∏£.10', '2032-08-12': '‡∏ß‡∏±‡∏ô‡πÅ‡∏°‡πà/‡∏û‡∏±‡∏ô‡∏õ‡∏µ‡∏´‡∏•‡∏ß‡∏á', 
            '2032-10-13': '‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡∏ï ‡∏£.9', '2032-10-25': '‡∏õ‡∏¥‡∏¢‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)',
            '2032-12-06': '‡∏ß‡∏±‡∏ô‡∏û‡πà‡∏≠/‡∏£.9 (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)', '2032-12-10': '‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç', '2033-01-03': '‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà (‡∏ä‡∏î‡πÄ‡∏ä‡∏¢)'
        };
        
        // --- (‡∏•‡∏ö) ‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞ (‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß) ---
        const buddhistHolyDays = []; 
        
        // --- Helper Functions ---

        // (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) Helper function ‡∏Å‡∏£‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î (‡∏•‡∏ö‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞‡∏≠‡∏≠‡∏Å)
        function isExcludedEvent(event) {
            const eventTitle = event.title || '';
            
            // 1. Check custom holiday tags (user-created)
            if (eventTitle.includes('üî¥ ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ø') ||
                eventTitle.includes('üèõÔ∏è ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£') ||
                eventTitle.includes('üôè ‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞')) { // (‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÉ‡∏ô DB)
                return true;
            }
            
            // 2. Check hardcoded holiday lists by date
            if (thaiHolidays[event.date] || buddhistHolyDays.includes(event.date)) { // (buddhistHolyDays ‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤)
                return true;
            }
            
            return false;
        }

        function isCustomCompanyHoliday(events) {
            return events.some(([key, event]) => 
                event.title && event.title.includes('üî¥ ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ø')
            );
        }
        
        function getEventsForDateStr(dateStr) {
            return Object.entries(allEvents).filter(([key, event]) => event.date === dateStr);
        }

        // --- Main Render Functions ---

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            document.getElementById('current-month').textContent = `${thaiMonths[month]} ${year + 543}`;

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            const prevMonthLastDay = new Date(year, month, 0).getDate();

            const calendarDaysEl = document.getElementById('calendar-days');
            calendarDaysEl.innerHTML = ''; 

            for (let i = startingDayOfWeek - 1; i >= 0; i--) {
                const dayDiv = createDayElement(prevMonthLastDay - i, true, null); 
                calendarDaysEl.appendChild(dayDiv);
            }
            for (let day = 1; day <= daysInMonth; day++) {
                const dateObj = new Date(year, month, day);
                const dayDiv = createDayElement(day, false, dateObj); 
                calendarDaysEl.appendChild(dayDiv);
            }
            const totalCells = calendarDaysEl.children.length;
            const remainingCells = (totalCells <= 35) ? (42 - totalCells) : (49 - totalCells); 
            let nextMonthDay = 1;
            for (let i = 0; i < remainingCells; i++) {
                const dayDiv = createDayElement(nextMonthDay++, true, null); 
                calendarDaysEl.appendChild(dayDiv);
            }

            renderUpcomingEvents();
            renderMonthlySummary();
            renderNotesList(); // (‡πÉ‡∏´‡∏°‡πà) ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏ô‡πâ‡∏ï
        }

        // (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) ‡∏•‡∏ö Logic ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞
        function createDayElement(day, isOtherMonth, dateObj) {
            const dayDiv = document.createElement('div');
            dayDiv.className = `calendar-day ${isOtherMonth ? 'other-month' : ''}`;

            const dateStr = dateObj ? `${dateObj.getFullYear()}-${String(dateObj.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}` : '';

            // --- Part 1: Day Number (Not scrollable) ---
            const dayLabelDiv = document.createElement('div');
            dayLabelDiv.className = 'font-semibold mb-1 day-number';
            dayLabelDiv.textContent = day;
            dayDiv.appendChild(dayLabelDiv);

            // --- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ" ---
            if (!isOtherMonth && dateObj) {
                const today = new Date();
                if (dateObj.toDateString() === today.toDateString()) {
                    dayDiv.classList.add('today');
                }
            }
            // --- (‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°) ---

            // --- Part 2: Content Wrapper (Scrollable) ---
            const contentWrapper = document.createElement('div');
            contentWrapper.className = 'day-content-wrapper';

            if (!isOtherMonth && dateObj) {
                
                const dayEvents = getEventsForDateStr(dateStr);
                
                // --- 1. Add Static (Hardcoded) Holidays First ---
                if (thaiHolidays[dateStr]) {
                    dayDiv.classList.add('public-holiday');
                    const holidayName = thaiHolidays[dateStr];
                    contentWrapper.innerHTML += `<div class="text-orange-700 holiday-label pointer-events-none">üèõÔ∏è <span class="desktop-text">${holidayName}</span></div>`;
                } 
                // (‡∏•‡∏ö else if (buddhistHolyDays...) ‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß)
                
                // --- 2. Add Dynamic (Firebase) Events ---
                const eventsToDisplay = dayEvents.sort(([, a], [, b]) => (a.time || '99:99').localeCompare(b.time || '99:99'));
                
                eventsToDisplay.forEach(([key, event]) => { 
                    
                    const eventDiv = document.createElement('div');
                    
                    if (event.title && event.title.includes('üî¥ ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ø')) {
                        dayDiv.classList.add('company-holiday'); 
                        eventDiv.className = 'event-item company-event'; 
                        eventDiv.innerHTML = `üî¥ <span class="desktop-text">${event.title.replace('üî¥ ', '')}</span>`;
                    
                    } else if (isExcludedEvent(event)) {
                        return; 
                    } else {
                        eventDiv.className = 'event-item';
                        eventDiv.innerHTML = `üîµ <span class="desktop-text">${event.time ? `${event.time} ` : ''}${event.title}</span>`; 
                    }

                    eventDiv.title = `${event.title} (‡πÇ‡∏î‡∏¢ ${event.author})`; 
                    eventDiv.onclick = (e) => {
                        e.stopPropagation(); 
                        showEventDetails(key, event); 
                    };
                    contentWrapper.appendChild(eventDiv);
                });


                // Click on day cell to ADD event
                dayDiv.onclick = () => {
                    document.getElementById('event-date').value = dateStr;
                    showAddEventModal();
                };

            } else {
                dayDiv.onclick = null; 
            }
            
            dayDiv.appendChild(contentWrapper); 
            return dayDiv;
        }

        // --- Function: Render Upcoming Events (Filtered) ---
        function renderUpcomingEvents() {
            const upcomingContainer = document.getElementById('upcoming-events');
            const today = new Date();
            today.setHours(0, 0, 0, 0); 
            const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000); 

            const upcomingEvents = Object.entries(allEvents)
                .map(([key, event]) => ({ key, ...event })) 
                .filter(event => {
                    try {
                        const eventDate = new Date(event.date + 'T00:00:00'); 
                        if (isNaN(eventDate)) return false; 
                        
                        const isUpcoming = eventDate >= today && eventDate < nextWeek;
                        if (!isUpcoming) return false;

                        if (isExcludedEvent(event)) { 
                            return false;
                        }
                        
                        return true;
                    } catch (e) { return false; }
                })
                .sort((a, b) => {
                    const timeA = a.time ? `T${a.time}:00` : 'T00:00:00';
                    const timeB = b.time ? `T${b.time}:00` : 'T00:00:00';
                    const dateA = new Date(a.date + timeA);
                    const dateB = new Date(b.date + timeB);
                    return dateA - dateB;
                });

            if (upcomingEvents.length === 0) {
                upcomingContainer.innerHTML = '<p class="text-gray-500 text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î) ‡πÉ‡∏ô 7 ‡∏ß‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤</p>';
                return;
            }

            upcomingContainer.innerHTML = upcomingEvents.map(event => {
                const eventDate = new Date(event.date + 'T00:00:00'); 
                const formattedDate = `${eventDate.getDate()} ${thaiMonths[eventDate.getMonth()]}`;
                const tomorrow = new Date(today.getTime() + 24 * 60 * 60 * 1000);

                let dateLabel = formattedDate;
                if (eventDate.toDateString() === today.toDateString()) dateLabel = '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ';
                else if (eventDate.toDateString() === tomorrow.toDateString()) dateLabel = '‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ';

                const eventJsonString = JSON.stringify(event).replace(/"/g, '&quot;');
                const bgColor = 'bg-blue-50 border-blue-500';

                return `
                    <div class="flex items-start justify-between p-3 ${bgColor} rounded-lg border-l-4 cursor-pointer hover:bg-blue-100" onclick='showEventDetails("${event.key}", ${eventJsonString})'>
                        <div class="flex-1 mr-4 overflow-hidden">
                            <div class="font-semibold text-sm lg:text-base text-gray-800 truncate" title="${event.title}">${event.title}</div>
                            <div class="text-xs lg:text-sm text-gray-600">${event.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}</div>
                        </div>
                        <div class="text-right flex-shrink-0">
                            <div class="text-sm lg:text-base font-medium text-blue-600">${event.time || '‡∏ï‡∏•‡∏≠‡∏î‡∏ß‡∏±‡∏ô'}</div>
                            <div class="text-xs lg:text-sm text-gray-500">${dateLabel}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // --- Function: Render Monthly Summary (Filtered) ---
        function renderMonthlySummary() {
            const summaryContainer = document.getElementById('monthly-summary-events');
            const titleEl = document.getElementById('monthly-summary-title');
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth();

            titleEl.textContent = `‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${thaiMonths[currentMonth]} ${currentYear + 543}`;

            const monthEvents = Object.entries(allEvents)
                .map(([key, event]) => ({ key, ...event }))
                .filter(event => {
                    try {
                        const eventDate = new Date(event.date + 'T00:00:00');
                        if (isNaN(eventDate)) return false;

                        const isCurrentMonth = eventDate.getFullYear() === currentYear && eventDate.getMonth() === currentMonth;
                        if (!isCurrentMonth) return false;

                        if (isExcludedEvent(event)) { 
                            return false;
                        }

                        return true;
                    } catch (e) { return false; }
                })
                .sort((a, b) => {
                    const timeA = a.time ? `T${a.time}:00` : 'T00:00:00';
                    const timeB = b.time ? `T${b.time}:00` : 'T00:00:00';
                    const dateA = new Date(a.date + timeA);
                    const dateB = new Date(b.date + timeB);
                    return dateA - dateB;
                });

            if (monthEvents.length === 0) {
                summaryContainer.innerHTML = '<p class="text-gray-500 text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î) ‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>';
                return;
            }

            summaryContainer.innerHTML = monthEvents.map(event => {
                const eventDate = new Date(event.date + 'T00:00:00');
                const formattedDate = `${eventDate.getDate()} ${thaiMonths[eventDate.getMonth()]}`;
                const eventJsonString = JSON.stringify(event).replace(/"/g, '&quot;');
                const bgColor = 'bg-blue-50 border-blue-500';

                return `
                    <div class="flex items-start justify-between p-3 ${bgColor} rounded-lg border-l-4 cursor-pointer hover:bg-blue-100" onclick='showEventDetails("${event.key}", ${eventJsonString})'>
                        <div class="flex-1 mr-4 overflow-hidden">
                            <div class="font-semibold text-sm lg:text-base text-gray-800 truncate" title="${event.title}">${event.title}</div>
                            <div class="text-xs lg:text-sm text-gray-600">${event.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}</div>
                        </div>
                        <div class="text-right flex-shrink-0">
                            <div class="text-sm lg:text-base font-medium text-blue-600">${event.time || '‡∏ï‡∏•‡∏≠‡∏î‡∏ß‡∏±‡∏ô'}</div>
                            <div class="text-xs lg:text-sm text-gray-500">${formattedDate}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // --- (‡πÉ‡∏´‡∏°‡πà) Function: Render Notes List (Filtered by Month) ---
        function renderNotesList() {
            const notesWrapper = document.getElementById('notes-list-wrapper');
            const notesTitle = document.getElementById('notes-title');
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth();

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÇ‡∏ô‡πâ‡∏ï‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏π
            notesTitle.textContent = `üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô${thaiMonths[currentMonth]})`;
            notesWrapper.innerHTML = '<div class="spinner"></div>'; // ‡πÅ‡∏™‡∏î‡∏á Spinner ‡∏Å‡πà‡∏≠‡∏ô

            // (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) ‡∏™‡∏£‡πâ‡∏≤‡∏á Key ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô YYYY-MM
            const currentMonthKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`;
            
            // (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) Detach listener ‡πÄ‡∏Å‡πà‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            if (currentNotesListenerRef) {
                currentNotesListenerRef.off('value');
            }

            // (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Path ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            currentNotesListenerRef = monthlyNotesRef.child(currentMonthKey);
            
            // (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            currentNotesListenerRef.orderByChild('timestamp').on('value', (snapshot) => {
                const notesData = snapshot.val();
                notesWrapper.innerHTML = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå Spinner/‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤

                if (!notesData) {
                    notesWrapper.innerHTML = `<p class="text-gray-500 text-center text-sm py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏ô‡πâ‡∏ï‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>`;
                    return;
                }
                
                const sortedNoteKeys = Object.keys(notesData).sort((a, b) => {
                    return (notesData[b].timestamp || 0) - (notesData[a].timestamp || 0);
                });
                
                sortedNoteKeys.forEach(noteKey => {
                    const note = notesData[noteKey];
                    const noteDiv = document.createElement('div');
                    noteDiv.className = 'bg-yellow-100 p-3 rounded-lg shadow relative';
                    
                    let formattedTimestamp = '';
                    if (note.createdAt) {
                        try {
                            const date = new Date(note.createdAt);
                            const day = date.getDate();
                            const month = thaiMonths[date.getMonth()].substring(0, 3); // ‡∏¢‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                            const time = date.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
                            formattedTimestamp = `<div class="text-xs text-gray-500 mt-2 text-right">${day} ${month}, ${time} ‡∏ô.</div>`;
                        } catch (e) {}
                    }

                    const formattedContent = note.content.replace(/\n/g, '<br>');
                    
                    noteDiv.innerHTML = `
                        <p class="text-sm text-gray-800 break-words whitespace-pre-wrap">${formattedContent}</p>
                        ${formattedTimestamp}
                        <button class="absolute top-1 right-1 text-red-400 hover:text-red-700 text-xs" onclick="deleteNote('${noteKey}')" title="‡∏•‡∏ö‡πÇ‡∏ô‡πâ‡∏ï">
                            (X)
                        </button>
                    `;
                    notesWrapper.appendChild(noteDiv);
                });
            }, (error) => {
                console.error("Firebase (notes) data load error:", error);
                notesWrapper.innerHTML = '<p class="text-red-500 text-center text-sm py-4">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏ô‡πâ‡∏ï‡πÑ‡∏î‡πâ</p>';
            });
        }


        // --- Modal Functions and Event Handlers ---

        function showAddEventModal() {
            document.getElementById('add-event-form').reset();
            const dateInput = document.getElementById('event-date');
            if (!dateInput.value) {
                dateInput.value = new Date().toISOString().split('T')[0];
            }
            document.getElementById('add-event-modal').classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
            selectedEventKey = null; 
        }

        function showEventDetails(key, event) {
            selectedEventKey = key;
            const detailsContent = document.getElementById('event-details-content');
            const timeDisplay = event.time ? `<p class="text-md mb-2"><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${event.time}</p>` : '';
            
            const eventDate = new Date(event.date + 'T00:00:00');
            const formattedDate = `${eventDate.getDate()} ${thaiMonths[eventDate.getMonth()]} ${eventDate.getFullYear() + 543}`;

            detailsContent.innerHTML = `
                <p class="text-xl font-semibold text-blue-700 mb-3">${event.title}</p>
                <p class="text-md mb-2"><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${formattedDate}</p>
                ${timeDisplay}
                <p class="text-md mb-2"><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong></p>
                <p class="text-gray-700 bg-gray-50 p-2 border rounded whitespace-pre-wrap break-words">${event.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}</p>
                <p class="text-sm text-gray-600 mt-4"><strong>‡∏ú‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°:</strong> ${event.author}</p>
            `;
            document.getElementById('event-details-modal').classList.add('show');
        }

        document.getElementById('delete-event-btn').onclick = () => {
            if (selectedEventKey && confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ?')) {
                eventsRef.child(selectedEventKey).remove()
                    .then(() => {
                        closeModal('event-details-modal');
                    })
                    .catch(error => {
                        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö: " + error.message);
                    });
            }
        };

        document.getElementById('add-event-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('event-title').value.trim();
            const date = document.getElementById('event-date').value;
            const time = document.getElementById('event-time').value || '';
            const description = document.getElementById('event-description').value.trim() || '';
            const author = document.getElementById('event-author').value.trim();

            if (!title || !date || !author) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡πÅ‡∏•‡∏∞ ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
                return;
            }

            const newEvent = {
                title: title,
                date: date,
                time: time,
                description: description,
                author: author,
                timestamp: firebase.database.ServerValue.TIMESTAMP 
            };

            eventsRef.push(newEvent)
                .then(() => {
                    closeModal('add-event-modal');
                })
                .catch(error => {
                    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: " + error.message);
                });
        });
        
        // --- (‡πÉ‡∏´‡∏°‡πà) Event Listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÇ‡∏ô‡πâ‡∏ï‡∏•‡∏¥‡∏™‡∏ï‡πå ---
        
        // 1. ‡∏õ‡∏∏‡πà‡∏° "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏ô‡πâ‡∏ï"
        document.getElementById('save-note-btn').onclick = () => {
            const noteTextarea = document.getElementById('new-note-textarea');
            const noteContent = noteTextarea.value.trim();
            
            if (noteContent) {
                // (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏ô‡πâ‡∏ï‡∏•‡∏á‡πÉ‡∏ô Path ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                const year = currentDate.getFullYear();
                const month = String(currentDate.getMonth() + 1).padStart(2, '0');
                const yearMonthKey = `${year}-${month}`;

                const newNote = {
                    content: noteContent,
                    createdAt: new Date().toISOString(), 
                    timestamp: firebase.database.ServerValue.TIMESTAMP 
                };
                
                monthlyNotesRef.child(yearMonthKey).push(newNote) // (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
                    .then(() => {
                        noteTextarea.value = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ä‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
                    })
                    .catch(error => {
                        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏ô‡πâ‡∏ï: " + error.message);
                    });
            }
        };

        // 2. (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏ö‡πÇ‡∏ô‡πâ‡∏ï (‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏•‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÑ‡∏´‡∏ô)
        window.deleteNote = (noteKey) => {
            if (!noteKey) return;

            // (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) ‡∏´‡∏≤ Path ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            const year = currentDate.getFullYear();
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const yearMonthKey = `${year}-${month}`;

            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÇ‡∏ô‡πâ‡∏ï‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                monthlyNotesRef.child(yearMonthKey).child(noteKey).remove() // (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
                    .catch(error => {
                        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÇ‡∏ô‡πâ‡∏ï: " + error.message);
                    });
            }
        }
        
        // --- Firebase Data Listeners ---
        
        // 1. Listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Events
        eventsRef.on('value', (snapshot) => {
            allEvents = snapshot.val() || {};
            renderCalendar(); // (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å renderCalendar() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å‡∏™‡πà‡∏ß‡∏ô
        }, (error) => {
            console.error("Firebase (events) data load error:", error);
            document.getElementById('calendar-days').innerHTML = '<div class="col-span-7 p-10 text-center text-red-500">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>';
            document.getElementById('upcoming-events').innerHTML = '<p class="text-red-500 text-center py-4">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
        });

        // 2. (‡∏•‡∏ö) Listener ‡πÇ‡∏ô‡πâ‡∏ï‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)
        // (‡∏•‡∏ö notesListRef.on('value', ...) ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏¥‡πâ‡∏á)

        // --- Initial Listeners for Modals/Buttons ---
        document.getElementById('add-event-btn').onclick = showAddEventModal;
        document.getElementById('cancel-event-btn').onclick = () => closeModal('add-event-modal');
        document.getElementById('close-details-btn').onclick = () => closeModal('event-details-modal');
        
        // (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡πÉ‡∏´‡πâ re-render ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á (‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡πÇ‡∏ô‡πâ‡∏ï)
        document.getElementById('prev-month').onclick = () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar(); // (renderCalendar ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å renderNotesList() ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
        };
        document.getElementById('next-month').onclick = () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar(); // (renderCalendar ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å renderNotesList() ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
        };

    </script>
</body>
</html>
