<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìÖ Work Calendar (Firebase)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        body { box-sizing: border-box; height: 100%; margin: 0; font-family: 'Sarabun', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        html { height: 100%; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #e5e7eb; }
        .calendar-day { background-color: white; min-height: 120px; padding: 8px; position: relative; cursor: pointer; } /* Added cursor pointer */
        .calendar-day.other-month { background-color: #f9fafb; color: #9ca3af; cursor: default; } /* Default cursor for other months */
        .calendar-day.today { background-color: #a7f3d0; }
        .event-item { background-color: #3b82f6; color: white; padding: 2px 6px; margin: 2px 0; border-radius: 4px; font-size: 11px; cursor: pointer; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; }
        .modal.show { display: flex; align-items: center; justify-content: center; }
        /* Simple loading spinner */
        .spinner { border: 4px solid rgba(0, 0, 0, 0.1); width: 36px; height: 36px; border-radius: 50%; border-left-color: #3b82f6; animation: spin 1s ease infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Ensure day number div doesn't block clicks */
        .day-number { pointer-events: none; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <div class="container mx-auto p-6 max-w-6xl">
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h1 id="calendar-title" class="text-3xl font-bold text-gray-800 mb-4">Work Calendar</h1>
            <div class="flex flex-wrap gap-4 items-center">
                <button id="add-event-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors"> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà </button>
                <div class="flex items-center gap-2">
                    <button id="prev-month" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg transition-colors"> ‚Üê ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô </button>
                    <span id="current-month" class="text-xl font-semibold text-gray-700 px-4 w-48 text-center"></span> <button id="next-month" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg transition-colors"> ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí </button>
                </div>
            </div>
             <div class="mt-4 flex flex-wrap gap-4 text-sm">
                <div class="flex items-center gap-2"><div class="w-4 h-4 bg-red-100 border border-red-200 rounded"></div><span class="text-gray-600">üèõÔ∏è ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</span></div>
                <div class="flex items-center gap-2"><div class="w-4 h-4 bg-orange-100 border border-orange-200 rounded"></div><span class="text-gray-600">üôè ‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞</span></div>
                <div class="flex items-center gap-2"><div class="w-4 h-4 bg-blue-100 border border-blue-200 rounded"></div><span class="text-gray-600">üìÖ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span></div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏°‡∏≤‡∏ñ‡∏∂‡∏á (7 ‡∏ß‡∏±‡∏ô)</h2>
            <div id="upcoming-events" class="space-y-3">
                 <div class="spinner"></div> </div>
        </div>

        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <div class="calendar-grid bg-gray-100 text-center font-semibold text-gray-700">
                <div class="p-4">‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</div> <div class="p-4">‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</div> <div class="p-4">‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£</div> <div class="p-4">‡∏û‡∏∏‡∏ò</div> <div class="p-4">‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ</div> <div class="p-4">‡∏®‡∏∏‡∏Å‡∏£‡πå</div> <div class="p-4">‡πÄ‡∏™‡∏≤‡∏£‡πå</div>
            </div>
            <div id="calendar-days" class="calendar-grid">
                <div class="col-span-7 p-10 text-center text-gray-500">
                    <div class="spinner"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
                </div>
            </div>
        </div>
    </div>

    <div id="add-event-modal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h2 class="text-xl font-bold text-gray-800 mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà</h2>
            <form id="add-event-form">
                <div class="mb-4"><label for="event-title" class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label> <input type="text" id="event-title" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></div>
                <div class="mb-4"><label for="event-date" class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label> <input type="date" id="event-date" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></div>
                <div class="mb-4"><label for="event-time" class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label> <input type="time" id="event-time" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></div>
                <div class="mb-4"><label for="event-description" class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label> <textarea id="event-description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea></div>
                <div class="mb-6"><label for="event-author" class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°</label> <input type="text" id="event-author" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></div>
                <div class="flex gap-3">
                    <button type="submit" id="save-event-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition-colors"> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å </button>
                    <button type="button" id="cancel-event-btn" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg font-medium transition-colors"> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button>
                </div>
            </form>
        </div>
    </div>

    <div id="event-details-modal" class="modal">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h2 class="text-xl font-bold text-gray-800 mb-4">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h2>
            <div id="event-details-content"></div>
            <div class="flex gap-3 mt-6">
                <button id="delete-event-btn" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-medium transition-colors"> ‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° </button>
                <button id="close-details-btn" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg font-medium transition-colors"> ‡∏õ‡∏¥‡∏î </button>
            </div>
        </div>
    </div>

    <script>
        // --- Firebase Configuration for work-calendar-fe6c1 ---
        const firebaseConfig = {
          apiKey: "AIzaSyA6yXwcdOihGZcttFwdB6ax_Wb_S8NHMGQ",
          authDomain: "work-calendar-fe6c1.firebaseapp.com",
          databaseURL: "https://work-calendar-fe6c1-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "work-calendar-fe6c1",
          storageBucket: "work-calendar-fe6c1.firebasestorage.app",
          messagingSenderId: "792437599231",
          appId: "1:792437599231:web:2420688ca88867f57155ca",
          measurementId: "G-XK0NJMT3EG" // Optional
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const eventsRef = db.ref("calendar_events"); // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°

        let currentDate = new Date();
        let allEvents = {}; // ‡πÉ‡∏ä‡πâ Object ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase
        let selectedEventKey = null; // ‡πÄ‡∏Å‡πá‡∏ö key ‡∏Ç‡∏≠‡∏á event ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å

        const thaiMonths = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];

        // --- ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞ (‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô) ---
        const thaiHolidays = {
            '2025-01-01': '‡∏ß‡∏±‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà', '2025-02-12': '‡∏ß‡∏±‡∏ô‡∏°‡∏≤‡∏Ü‡∏ö‡∏π‡∏ä‡∏≤', '2025-04-06': '‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏Å‡∏£‡∏µ',
            '2025-04-13': '‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2025-04-14': '‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2025-04-15': '‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå',
            '2025-05-01': '‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏´‡πà‡∏á‡∏ä‡∏≤‡∏ï‡∏¥', '2025-05-04': '‡∏ß‡∏±‡∏ô‡∏â‡∏±‡∏ï‡∏£‡∏°‡∏á‡∏Ñ‡∏•', '2025-05-10': '‡∏ß‡∏±‡∏ô‡∏ß‡∏¥‡∏™‡∏≤‡∏Ç‡∏ö‡∏π‡∏ä‡∏≤',
            '2025-06-03': '‡∏ß‡∏±‡∏ô‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤‡∏™‡∏°‡πÄ‡∏î‡πá‡∏à‡∏û‡∏£‡∏∞‡∏ô‡∏≤‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏™‡∏∏‡∏ó‡∏¥‡∏î‡∏≤', '2025-07-28': '‡∏ß‡∏±‡∏ô‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤‡∏û‡∏£‡∏∞‡∏ö‡∏≤‡∏ó‡∏™‡∏°‡πÄ‡∏î‡πá‡∏à‡∏û‡∏£‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏±‡∏ß',
            '2025-08-08': '‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏™‡∏≤‡∏¨‡∏´‡∏ö‡∏π‡∏ä‡∏≤', '2025-08-09': '‡∏ß‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏£‡∏£‡∏©‡∏≤', '2025-08-12': '‡∏ß‡∏±‡∏ô‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤‡∏™‡∏°‡πÄ‡∏î‡πá‡∏à‡∏û‡∏£‡∏∞‡∏ô‡∏≤‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏™‡∏¥‡∏£‡∏¥‡∏Å‡∏¥‡∏ï‡∏¥‡πå',
            '2025-10-13': '‡∏ß‡∏±‡∏ô‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡∏ï ‡∏£.9', '2025-10-23': '‡∏ß‡∏±‡∏ô‡∏õ‡∏¥‡∏¢‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä',
            '2025-12-05': '‡∏ß‡∏±‡∏ô‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏™‡∏°‡∏†‡∏û ‡∏£.9', '2025-12-10': '‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç', '2025-12-31': '‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏õ‡∏µ',
            '2026-01-01': '‡∏ß‡∏±‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà', '2026-03-04': '‡∏ß‡∏±‡∏ô‡∏°‡∏≤‡∏Ü‡∏ö‡∏π‡∏ä‡∏≤', '2026-04-06': '‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏Å‡∏£‡∏µ',
            '2026-04-13': '‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2026-04-14': '‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', '2026-04-15': '‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå',
            '2026-05-01': '‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏´‡πà‡∏á‡∏ä‡∏≤‡∏ï‡∏¥', '2026-05-04': '‡∏ß‡∏±‡∏ô‡∏â‡∏±‡∏ï‡∏£‡∏°‡∏á‡∏Ñ‡∏•', '2026-05-30': '‡∏ß‡∏±‡∏ô‡∏ß‡∏¥‡∏™‡∏≤‡∏Ç‡∏ö‡∏π‡∏ä‡∏≤',
            '2026-06-03': '‡∏ß‡∏±‡∏ô‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤‡∏™‡∏°‡πÄ‡∏î‡πá‡∏à‡∏û‡∏£‡∏∞‡∏ô‡∏≤‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏™‡∏∏‡∏ó‡∏¥‡∏î‡∏≤', '2026-07-27': '‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏™‡∏≤‡∏¨‡∏´‡∏ö‡∏π‡∏ä‡∏≤',
            '2026-07-28': '‡∏ß‡∏±‡∏ô‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤ ‡∏£.10', '2026-07-29': '‡∏ß‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏£‡∏£‡∏©‡∏≤',
            '2026-08-12': '‡∏ß‡∏±‡∏ô‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏û‡∏£‡∏∞‡∏ä‡∏ô‡∏°‡∏û‡∏£‡∏£‡∏©‡∏≤‡∏™‡∏°‡πÄ‡∏î‡πá‡∏à‡∏û‡∏£‡∏∞‡∏ô‡∏≤‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏™‡∏¥‡∏£‡∏¥‡∏Å‡∏¥‡∏ï‡∏¥‡πå', '2026-10-13': '‡∏ß‡∏±‡∏ô‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡∏ï ‡∏£.9',
            '2026-10-23': '‡∏ß‡∏±‡∏ô‡∏õ‡∏¥‡∏¢‡∏°‡∏´‡∏≤‡∏£‡∏≤‡∏ä', '2026-12-05': '‡∏ß‡∏±‡∏ô‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏™‡∏°‡∏†‡∏û ‡∏£.9',
            '2026-12-10': '‡∏ß‡∏±‡∏ô‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç', '2026-12-31': '‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏õ‡∏µ'
        };
        const buddhistHolyDays = [
            '2025-01-06', '2025-01-13', '2025-01-21', '2025-01-29', '2025-02-05', '2025-02-12', '2025-02-20', '2025-02-28',
            '2025-03-07', '2025-03-14', '2025-03-22', '2025-03-30', '2025-04-06', '2025-04-13', '2025-04-21', '2025-04-29',
            '2025-05-06', '2025-05-13', '2025-05-21', '2025-05-28', '2025-06-05', '2025-06-12', '2025-06-20', '2025-06-27',
            '2025-07-05', '2025-07-12', '2025-07-19', '2025-07-27', '2025-08-03', '2025-08-10', '2025-08-18', '2025-08-25',
            '2025-09-02', '2025-09-09', '2025-09-16', '2025-09-23', '2025-10-01', '2025-10-08', '2025-10-15', '2025-10-23',
            '2025-10-30', '2025-11-06', '2025-11-13', '2025-11-21', '2025-11-28', '2025-12-06', '2025-12-13', '2025-12-21',
            '2025-12-28', '2026-01-04', '2026-01-12', '2026-01-19', '2026-01-27', '2026-02-03', '2026-02-11', '2026-02-18',
            '2026-02-26', '2026-03-06', '2026-03-13', '2026-03-21', '2026-03-28', '2026-04-05', '2026-04-12', '2026-04-20',
            '2026-04-27', '2026-05-05', '2026-05-12', '2026-05-20', '2026-05-27', '2026-06-04', '2026-06-11', '2026-06-19',
            '2026-06-26', '2026-07-04', '2026-07-11', '2026-07-18', '2026-07-26', '2026-08-02', '2026-08-09', '2026-08-17',
            '2026-08-24', '2026-08-31', '2026-09-08', '2026-09-15', '2026-09-22', '2026-09-30', '2026-10-07', '2026-10-14',
            '2026-10-22', '2026-10-29', '2026-11-05', '2026-11-12', '2026-11-20', '2026-11-27', '2026-12-05', '2026-12-12',
            '2026-12-20', '2026-12-27'
        ];
        // --- ‡∏à‡∏ö‡∏™‡πà‡∏ß‡∏ô ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞ ---

        // --- Function: Render Calendar ---
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            document.getElementById('current-month').textContent = `${thaiMonths[month]} ${year + 543}`;

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            const prevMonthLastDay = new Date(year, month, 0).getDate();

            const calendarDaysEl = document.getElementById('calendar-days');
            calendarDaysEl.innerHTML = ''; // Clear previous days

            // Previous month days
            for (let i = startingDayOfWeek - 1; i >= 0; i--) {
                const dayDiv = createDayElement(prevMonthLastDay - i, true, null); // Pass null for date obj
                calendarDaysEl.appendChild(dayDiv);
            }

            // Current month days
            for (let day = 1; day <= daysInMonth; day++) {
                const dateObj = new Date(year, month, day);
                const dayDiv = createDayElement(day, false, dateObj); // Pass date object
                calendarDaysEl.appendChild(dayDiv);
            }

            // Next month days to fill grid rows properly
            const totalCells = calendarDaysEl.children.length;
            const remainingCells = (totalCells <= 35) ? (42 - totalCells) : (49 - totalCells); // Ensure 6 or 7 rows

            let nextMonthDay = 1;
            for (let i = 0; i < remainingCells; i++) {
                 const dayDiv = createDayElement(nextMonthDay++, true, null); // Pass null for date obj
                 calendarDaysEl.appendChild(dayDiv);
            }


            renderUpcomingEvents();
        }

        // --- Function: Create Day Element ---
        function createDayElement(day, isOtherMonth, dateObj) {
            const dayDiv = document.createElement('div');
            dayDiv.className = `calendar-day ${isOtherMonth ? 'other-month' : ''}`;

            let dayLabel = `<div class="font-semibold text-sm mb-1 day-number">${day}</div>`; // Added day-number class
            const dateStr = dateObj ? `${dateObj.getFullYear()}-${String(dateObj.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}` : '';

            if (!isOtherMonth && dateObj) {
                const today = new Date();
                if (dateObj.toDateString() === today.toDateString()) {
                    dayDiv.classList.add('today');
                }

                // Check holidays and holy days
                if (thaiHolidays[dateStr]) {
                    dayLabel += `<div class="text-xs text-red-600 font-medium mb-1 pointer-events-none">üèõÔ∏è ${thaiHolidays[dateStr]}</div>`;
                    dayDiv.style.backgroundColor = '#fef2f2';
                }
                if (buddhistHolyDays.includes(dateStr)) {
                     dayLabel += `<div class="text-xs text-orange-600 font-medium mb-1 pointer-events-none">üôè ‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞</div>`;
                     if (!thaiHolidays[dateStr]) { // Avoid overwriting holiday color
                         dayDiv.style.backgroundColor = '#fff7ed';
                     }
                }

                // Add events ordered by time
                const dayEvents = getEventsForDateStr(dateStr).sort(([, a], [, b]) => {
                    const timeA = a.time || '99:99'; // Put events without time last
                    const timeB = b.time || '99:99';
                    return timeA.localeCompare(timeB);
                });
                dayEvents.forEach(([key, event]) => { // Get key and event data
                    const eventDiv = document.createElement('div');
                    eventDiv.className = 'event-item';
                    eventDiv.textContent = event.time ? `${event.time} ${event.title}` : event.title;
                    eventDiv.title = `${event.title}${event.time ? ' ('+event.time+')': ''}${event.description ? ' - '+event.description : ''} (‡πÇ‡∏î‡∏¢ ${event.author})`; // Tooltip
                    eventDiv.onclick = (e) => {
                        e.stopPropagation(); // Prevent day click when clicking event
                        showEventDetails(key, event);
                    };
                    dayDiv.appendChild(eventDiv);
                });

                // Click on day to add event
                dayDiv.onclick = () => {
                    document.getElementById('event-date').value = dateStr;
                    showAddEventModal();
                };

            } else {
                 dayDiv.onclick = null; // Disable click for other month days
            }

            // Use innerHTML carefully, place existing event divs after day label
            const tempContainer = document.createElement('div');
            tempContainer.innerHTML = dayLabel;
            while(dayDiv.firstChild) {
                tempContainer.appendChild(dayDiv.firstChild);
            }
            dayDiv.appendChild(tempContainer);


            return dayDiv;
        }

         // --- Function: Get Events for Date String ---
        function getEventsForDateStr(dateStr) {
            // Returns an array of [key, eventObject] pairs
            return Object.entries(allEvents).filter(([key, event]) => event.date === dateStr);
        }

        // --- Function: Render Upcoming Events ---
        function renderUpcomingEvents() {
            const upcomingContainer = document.getElementById('upcoming-events');
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Start of today
            const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000); // End of 7 days from now (exclusive)

            const upcomingEvents = Object.entries(allEvents)
                .map(([key, event]) => ({ key, ...event })) // Include the key
                .filter(event => {
                    try {
                        // Handle potential invalid date strings gracefully
                        const eventDate = new Date(event.date + 'T00:00:00'); // Assume start of day if date is valid
                        if (isNaN(eventDate)) return false; // Skip if date is invalid
                        return eventDate >= today && eventDate < nextWeek; // Check if within the next 7 days
                    } catch (e) {
                        console.warn("Skipping event with potentially invalid date:", event);
                        return false;
                    }
                })
                .sort((a, b) => {
                     // Sort by date, then by time if available
                     const dateA = new Date(a.date + (a.time ? `T${a.time}:00` : 'T00:00:00'));
                     const dateB = new Date(b.date + (b.time ? `T${b.time}:00` : 'T00:00:00'));
                     // Handle invalid dates during sort
                     if (isNaN(dateA) && isNaN(dateB)) return 0;
                     if (isNaN(dateA)) return 1;
                     if (isNaN(dateB)) return -1;
                     return dateA - dateB;
                 });

            if (upcomingEvents.length === 0) {
                upcomingContainer.innerHTML = '<p class="text-gray-500 text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏°‡∏≤‡∏ñ‡∏∂‡∏á‡πÉ‡∏ô 7 ‡∏ß‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤</p>';
                return;
            }

            upcomingContainer.innerHTML = upcomingEvents.map(event => {
                const eventDate = new Date(event.date + 'T00:00:00'); // Ensure it's treated as local date
                const formattedDate = `${eventDate.getDate()} ${thaiMonths[eventDate.getMonth()]}`;
                const tomorrow = new Date(today.getTime() + 24 * 60 * 60 * 1000);

                let dateLabel = formattedDate;
                if (eventDate.toDateString() === today.toDateString()) dateLabel = '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ';
                else if (eventDate.toDateString() === tomorrow.toDateString()) dateLabel = '‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ';

                // Escape quotes in JSON string for onclick handler
                const eventJsonString = JSON.stringify(event).replace(/"/g, '&quot;');

                return `
                    <div class="flex items-start justify-between p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500 cursor-pointer hover:bg-blue-100" onclick='showEventDetails("${event.key}", ${eventJsonString})'>
                        <div class="flex-1 mr-4 overflow-hidden">
                            <div class="font-semibold text-gray-800 truncate" title="${event.title}">${event.title}</div>
                            <div class="text-sm text-gray-600">${dateLabel}${event.time ? ` ‡πÄ‡∏ß‡∏•‡∏≤ ${event.time}` : ''}</div>
                            ${event.description ? `<div class="text-sm text-gray-500 mt-1 truncate" title="${event.description}">${event.description}</div>` : ''}
                        </div>
                        <div class="text-xs text-gray-500 text-right whitespace-nowrap">‡πÇ‡∏î‡∏¢ ${event.author}</div>
                    </div>
                `;
            }).join('');
        }


        // --- Modal Functions ---
        function showAddEventModal() { document.getElementById('add-event-modal').classList.add('show'); document.getElementById('event-title').focus(); }
        function hideAddEventModal() { document.getElementById('add-event-modal').classList.remove('show'); document.getElementById('add-event-form').reset(); }
        function showEventDetails(key, event) {
            selectedEventKey = key; // Store the key
            const content = document.getElementById('event-details-content');
            // Ensure date is parsed correctly, assuming local timezone
            const eventDate = new Date(event.date + 'T00:00:00');
            let formattedDate = "Invalid Date";
            if (!isNaN(eventDate)) {
                 formattedDate = `${eventDate.getDate()} ${thaiMonths[eventDate.getMonth()]} ${eventDate.getFullYear() + 543}`;
            }

            content.innerHTML = `<div class="space-y-3"><div><span class="font-semibold text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:</span> <p class="text-gray-800 break-words">${event.title || '-'}</p></div><div><span class="font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</span> <p class="text-gray-800">${formattedDate}</p></div>${event.time ? `<div><span class="font-semibold text-gray-700">‡πÄ‡∏ß‡∏•‡∏≤:</span> <p class="text-gray-800">${event.time}</p></div>` : ''}${event.description ? `<div><span class="font-semibold text-gray-700">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</span> <p class="text-gray-800 break-words">${event.description}</p></div>` : ''}<div><span class="font-semibold text-gray-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏î‡∏¢:</span> <p class="text-gray-800 break-words">${event.author || '-'}</p></div></div>`;
            document.getElementById('event-details-modal').classList.add('show');
        }
        function hideEventDetails() { document.getElementById('event-details-modal').classList.remove('show'); selectedEventKey = null; }

        // --- Firebase Functions ---
        async function addEventToFirebase(eventData) {
            const saveBtn = document.getElementById('save-event-btn');
            saveBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...'; saveBtn.disabled = true;

            try {
                // Basic validation
                if (!eventData.title || !eventData.date || !eventData.author) {
                     throw new Error("Missing required fields: title, date, or author.");
                }
                // Validate date format (YYYY-MM-DD)
                 if (!/^\d{4}-\d{2}-\d{2}$/.test(eventData.date)) {
                    throw new Error("Invalid date format. Use YYYY-MM-DD.");
                 }
                 // Validate time format (HH:MM) if present
                 if (eventData.time && !/^\d{2}:\d{2}$/.test(eventData.time)) {
                     throw new Error("Invalid time format. Use HH:MM.");
                 }

                await eventsRef.push({
                    title: eventData.title,
                    date: eventData.date,
                    time: eventData.time || null, // Store null if no time
                    description: eventData.description || null, // Store null if no description
                    author: eventData.author,
                    created_at: firebase.database.ServerValue.TIMESTAMP // Use server timestamp
                });
                hideAddEventModal();
                showMessage('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
            } catch (error) {
                console.error("Error adding event:", error);
                showMessage(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
            } finally {
                 saveBtn.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'; saveBtn.disabled = false;
            }
        }

        async function deleteEventFromFirebase() {
            if (!selectedEventKey) return;
            if (!confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ?')) return; // Confirmation

            const deleteBtn = document.getElementById('delete-event-btn');
            deleteBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...'; deleteBtn.disabled = true;

            try {
                await eventsRef.child(selectedEventKey).remove();
                hideEventDetails();
                showMessage('‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
            } catch (error) {
                console.error("Error deleting event:", error);
                showMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            } finally {
                 deleteBtn.textContent = '‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°'; deleteBtn.disabled = false;
            }
        }

        // --- Helper: Show Message ---
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg text-white z-[1001] shadow-lg ${type === 'success' ? 'bg-green-600' : 'bg-red-600'}`; // Position bottom-right
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            setTimeout(() => {
                messageDiv.style.opacity = '0'; // Fade out
                messageDiv.style.transition = 'opacity 0.5s ease';
                setTimeout(() => messageDiv.remove(), 500); // Remove after fade
             }, 3000);
        }

        // --- Event Listeners ---
        document.getElementById('add-event-btn').onclick = () => {
             // Set default date to today if opening without clicking a day
             const dateInput = document.getElementById('event-date');
             if (!dateInput.value) {
                 const today = new Date();
                 dateInput.value = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
             }
            showAddEventModal();
        };
        document.getElementById('cancel-event-btn').onclick = hideAddEventModal;
        document.getElementById('close-details-btn').onclick = hideEventDetails;
        document.getElementById('delete-event-btn').onclick = deleteEventFromFirebase; // Changed to Firebase delete
        document.getElementById('prev-month').onclick = () => { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(); };
        document.getElementById('next-month').onclick = () => { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(); };
        document.getElementById('add-event-form').onsubmit = (e) => {
            e.preventDefault();
            addEventToFirebase({ // Changed to Firebase add
                title: document.getElementById('event-title').value.trim(),
                date: document.getElementById('event-date').value,
                time: document.getElementById('event-time').value,
                description: document.getElementById('event-description').value.trim(),
                author: document.getElementById('event-author').value.trim()
            });
        };
        // Close modals on outside click
        document.getElementById('add-event-modal').onclick = (e) => { if (e.target.id === 'add-event-modal') hideAddEventModal(); };
        document.getElementById('event-details-modal').onclick = (e) => { if (e.target.id === 'event-details-modal') hideEventDetails(); };

        // --- Firebase Listener ---
        eventsRef.on('value', (snapshot) => {
            allEvents = snapshot.val() || {}; // Update events from Firebase
            console.log("Data from Firebase:", allEvents); // Log data for debugging
            renderCalendar(); // Re-render the calendar with new data
        }, (error) => {
             console.error("Firebase read failed:", error);
             document.getElementById('calendar-days').innerHTML = '<div class="col-span-7 p-10 text-center text-red-600">‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase ‡πÅ‡∏•‡∏∞ Rules</div>';
             document.getElementById('upcoming-events').innerHTML = '<div class="p-10 text-center text-red-600">‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>';
             showMessage('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Firebase ‡πÑ‡∏î‡πâ', 'error');
        });

    </script>
</body>
</html>
